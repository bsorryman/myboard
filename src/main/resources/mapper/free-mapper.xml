<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.myboard.api.free.repository.FreeListMapper">
	
	<resultMap id="freePost" type="com.myboard.api.free.domain.FreePost">
		<result column="idx" property="idx" />
		<result column="title" property="title" />
		<result column="writer" property="writer" />
		<result column="password" property="password" />
		<result column="contents" property="contents" />
		<result column="created_at" property="createdAt" />
		<result column="hits" property="hits" />
	</resultMap>	
	
	<select id="selectTotalFreePost" resultType="int">
		SELECT COUNT(*) 
		FROM tb_free_board
		WHERE 1 = 1
		<if test="field=='name'">
		AND title LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test="field=='contents'">
		AND contents LIKE CONCAT('%', #{keyword}, '%')
		</if>
	</select>
	
	<!-- Select Free Post list  -->
	<select id="selectFreePostList" resultMap="freePost">
	    <bind name="offset" value="@com.myboard.api.free.domain.FreePost@seekOffset(page, size)"/>
	    SELECT *
		FROM tb_free_board
		WHERE 1 = 1
		<if test="field=='name'">
		AND title LIKE CONCAT('%', #{keyword}, '%')
		</if>
		<if test="field=='contents'">
		AND contents LIKE CONCAT('%', #{keyword}, '%')
		</if>
		ORDER BY idx DESC
		LIMIT #{offset}, #{size}		
	</select>	
	
	<!-- Insert Free Post -->
	<insert id="insertFreePost" parameterType="com.myboard.api.free.domain.FreePost">
		INSERT INTO tb_free_board(title, writer, password, contents)
		VALUES(#{title}, #{writer}, #{password}, #{contents})
	</insert>
	
	<!-- Select Free Post (one) -->
	<select id="selectFreePost" resultMap="freePost">
		SELECT *
		FROM tb_free_board
		WHERE idx = #{idx}
	</select>
	
	<!-- Delete Free Post -->
	<delete id="deleteFreePost">
		DELETE
		FROM tb_free_board
		WHERE idx = #{idx}
		AND password = #{password}
	</delete>
	
	<!-- Update Free Post -->
	<update id="updateFreePost" parameterType="com.myboard.api.free.domain.FreePost">
		UPDATE tb_free_board
		SET title = #{title}, contents = #{contents}
		WHERE idx = #{idx}	
		AND password = #{password}
	</update>
	
	<!-- Add Hits of Free Post -->
	<update id="updateHitsOfFreePost">
		UPDATE tb_free_board
		SET hits = IFNULL(hits, 0) + 1
		WHERE idx = #{idx}	
	</update>
</mapper>